授業時間管理アプリ 仕様書（Lesson Pace Maker）

1. プロジェクト概要
   1.1 背景・目的
   授業中に「説明が長引く」「作業が遅れる」といった理由で、予定していた内容（特に振り返り）を完結できない課題を解決する。教員が授業の進行状況を「視界の端」で把握でき、かつ最小限の操作で計画を修正できるツールを提供する。

1.2 コアバリュー
低コスト運用: 授業中にデバイスを注視・操作する時間を極限まで削減。

柔軟な調整: ロック画面からの操作や、動的な残り時間の再配分機能。

2. システム構成・技術スタック
   開発効率とパフォーマンスを両立するため、以下のスタックを選定する。

Framework: Flutter (iOS / Android クロスプラットフォーム)

対応デバイス: iPhone / Android / その他タブレット端末

State Management: Riverpod (状態管理の安定性とテスト容易性の確保)

Local Database: Isar (NoSQL / 高速なローカルデータ永続化)

Notification: flutter_local_notifications (ロック画面操作・通知制御)

3. 機能要件
   3.1 テンプレート管理
   プリセット機能: アプリ初回起動時に、一般的な授業スタイル（講義型、演習型など）を初期データとしてIsar DBへ投入する。

カスタム作成: ユーザーが独自の授業フェーズ（導入、展開、まとめ等）の比率を保存できる。

クイックスタート: 授業開始直前に、保存されたテンプレートから1タップで計測を開始できる。

3.2 タイムキーピング・エンジン
リアルタイム追跡: 授業開始からの累計経過時間と、現在のフェーズの残り時間を並行して管理。

フェーズ移行: 手動タップによる次フェーズ移行、または設定による自動移行をサポート。

バックグラウンド動作: アプリが非表示の状態でもカウントを継続し、設定時刻に通知をトリガーする。

3.3 信号機UI（ペースメーカー）
進捗状況を色でフィードバックし、教員のメタ認知をサポートする。 | ステータス | 背景色 | 判定条件 | | :--- | :--- | :--- | | OK | 緑 | 残り時間 ＞ 1分 | | WARN | 黄 | 残り時間 ≦ 1分 | | CRITICAL | 赤 | 予定時間を超過（マイナスカウント中） |

3.4 「巻き（Maki）」調整ロジック(内部ロジック、ボタンなどでは表示しない)
「計画と現実のズレ」を自動で解消する。

実行内容: 実行時点の「物理的な残り授業時間」を、未完了の全ステップの「予定比率」に基づいて均等に再配分する。

発火条件: ユーザーが「次へ」ボタンを押したとき

挙動:

押し気味（遅延時）: 残りの全枠を等倍で短縮。

巻き気味（余裕時）: 余った時間を残りの全枠に等倍で追加。

3.5 通知・ロック画面操作
通知内アクション: ロック画面に表示される通知上に「次へ」のボタンを配置し、アプリを開かずに制御可能とする。

触覚フィードバック: 時間終了間近・フェーズ終了時に特定のパターンで振動させる。

4. UI/UX デザイン仕様
   リファレンス: デザイン案 (Google Stitch)

5. 非機能要件
   フォアグラウンドサービス: AndroidにおいてOSによるプロセス殺害を防止し、タイマーの精度を担保する。

省電力設計: リフレッシュレートを最適化し、授業中のiPadのバッテリー消費を抑える。

オフライン動作: 学校環境（Wi-Fi不安定）を考慮し、全機能をローカルで完結させる。

6. 開発ロードマップ
   Phase 1: ローカル完結型 MVP (優先開発)
   IsarによるローカルDB実装。

タイマーエンジンと信号機UIの実装。

ローカル通知によるロック画面操作の実装。

Phase 2: クラウド連携・バックアップ (将来拡張)
自動バックアップ: ログイン認証（Firebase等）によるデータ同期。

マルチデバイス同期: スマートフォンで作成したテンプレートのタブレットへの自動反映。

アナリティクス: どの授業で、どのフェーズが遅れやすいかのログ解析機能。
